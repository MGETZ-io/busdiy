<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR-Code Zutrittskontrolle</title>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #111; color: #fff; }
        #scanner-container { width: 300px; margin: auto; border: 2px solid #00ff00; }
        #message { margin-top: 10px; font-size: 18px; }
        .valid { color: #00ff00; }
        .invalid { color: #ff0000; }
    </style>
</head>
<body>
    <h1>Bitte QR-Code scannen</h1>
    <div id="scanner-container"></div>
    <p id="message">Scanne einen QR-Code...</p>

    <script>
        // Erlaubte QR-Codes
        const validQRCodes = ["PREMIUM123", "VIP456", "TICKET789"];

        function startScanner() {
            const scanner = new Html5Qrcode("scanner-container");
            Html5Qrcode.getCameras().then(devices => {
                if (devices.length === 0) {
                    document.getElementById("message").innerHTML = "<span class='invalid'>❌ Keine Kamera gefunden!</span>";
                    return;
                }

                scanner.start(devices[0].id, { fps: 10, qrbox: 250 }, qrCodeMessage => {
                    scanner.stop(); // Scanner pausieren
                    checkQRCode(qrCodeMessage);
                }).catch(err => console.error("Fehler beim Starten:", err));
            }).catch(err => console.error("Kamera-Zugriff verweigert:", err));
        }

        function checkQRCode(code) {
            const messageBox = document.getElementById("message");
            if (validQRCodes.includes(code)) {
                messageBox.innerHTML = "<span class='valid'>✅ QR-Code gültig! Tür öffnet...</span>";
                setTimeout(() => location.reload(), 5000); // Seite neu laden
            } else {
                messageBox.innerHTML = "<span class='invalid'>❌ Ungültiger QR-Code! Zugang verweigert.</span>";
                setTimeout(() => location.reload(), 5000);
            }
        }

        startScanner();
    </script>
</body>
</html>
